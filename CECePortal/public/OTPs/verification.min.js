const inputs = document.querySelectorAll(".otp-field > input");
const button = document.querySelector(".btn");

window.addEventListener("load", () => {
    inputs[0].focus();
    button.setAttribute("disabled", "disabled");
});

inputs.forEach((input, index) => {
    input.addEventListener("input", (e) => {
        if (input.value.length > 1) {
            input.value = ""; // Prevent more than one character
            return;
        }

        if (e.inputType !== "deleteContentBackward") {
            if (input.value && index < inputs.length - 1) {
                inputs[index + 1].removeAttribute("disabled");
                inputs[index + 1].focus();
            }
        } else if (e.inputType === "deleteContentBackward") {
            if (index > 0) {
                inputs[index].setAttribute("disabled", "disabled");
                inputs[index - 1].focus();
            }
        }

        // Check if all inputs are filled
        const allFilled = Array.from(inputs).every(input => input.value.length === 1);
        button.disabled = !allFilled;
    });

    input.addEventListener("keydown", (e) => {
        // Handle backspace for deleting and moving to the previous box
        if (e.key === "Backspace" && !input.value && index > 0) {
            inputs[index - 1].focus();
        }

        // Handle backspace for deleting and moving to the previous box
        if (e.key === "Delete" && !input.value && index > 0) {
            inputs[index - 1].focus();
        }
    });
});

// Handle pasting into the first box
inputs[0].addEventListener("paste", (event) => {
    event.preventDefault();
    const pastedValue = (event.clipboardData || window.clipboardData).getData("text").split("");

    // Fill inputs with pasted value
    inputs.forEach((input, i) => {
        if (pastedValue[i]) {
            input.value = pastedValue[i];
            if (i < inputs.length - 1) inputs[i + 1].removeAttribute("disabled");
        } else {
            input.value = "";
            input.setAttribute("disabled", "disabled");
        }
    });

    // Enable button if all inputs are filled
    const allFilled = Array.from(inputs).every(input => input.value.length === 1);
    button.disabled = !allFilled;
});
